<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Taller de Desarrollo 212</title>
    <!-- BootStrap5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <style>
        p {
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row text-center my-3">
            <div class="col-12 col-md-6">
                <h1>Taller de Desarrollo 212</h1>
            </div>
            <div class="col-12 col-md-6">
                <p><button class="btn btn-primary" id="btnElegir" onclick="elegirAlumno()">Elegir alumno</button></p>
            </div>
        </div>
        <div class="row" id="listaAlumnos">
        </div>
    </div>

    <!-- BootStrap5 -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>

    <script>


    const APIURL = 'alumnos.json';

    var arregloAlumnos = [];

    fetch(APIURL)
    .then(function(response) {

        if (response.status !== 200) {
            console.log('Ocurrió un error. Código de error: ' + response.status);
            return;
        }

        response.json().then(function(alumnos) {

            html = '';
            let contador = 0;
            alumnos.forEach( function(alumno) {

                    estado = `<span class="badge bg-success">`+ alumno.participaciones +`</span>`;
                    if(!alumno.participaciones)
                        estado = ' ';

                    html += `
                        <div class="col-6 col-md-1 p-1 text-center animated zoomIn wow" id="alumno${contador}">     
                            <img class="border border-white hvr-grow" src="imagenes/sin-foto.webp" width="100px" alt="${ alumno.nombre }">
                            <p>${ estado } <strong>${ alumno.nombre }</strong> ${ alumno.apellidos }</p>               
                        </div>       
                    `;                        
                
                    datoAlumno = { 
                                    id : contador, 
                                    nombre : alumno.nombre + " " + alumno.apellidos,
                                    participaciones : alumno.participaciones
                                };

                    arregloAlumnos.push(datoAlumno);
                    contador++;
            });

            var listaAlumnos = document.getElementById('listaAlumnos');                                        
            listaAlumnos.innerHTML = html;
            console.log(arregloAlumnos);
            console.table(arregloAlumnos);   
        });
        
    })
    .catch(function(err) {
        console.log(err);
    });


    function elegirAlumno() {            
        
        let alumnoElegido = arregloAlumnos[Math.floor(Math.random()*arregloAlumnos.length)];

        console.log('Elegido: ' + alumnoElegido.id);

        let destacarAlumno = document.getElementById("alumno" + alumnoElegido.id);

        destacarAlumno.classList.add("border");
        destacarAlumno.classList.add("border-success");
        destacarAlumno.classList.add("border-2");
        destacarAlumno.classList.add("rounded");
        destacarAlumno.classList.add("bg-light");
        destacarAlumno.classList.add("shadow");

        arregloAlumnos = arregloAlumnos.filter(function(alumno) { 
            //return alumno.id != alumnoElegido.id; 
            console.log('FILTRO:' + alumno.nombre);
            return alumno.participaciones < 1; 
        }); 

        console.log(arregloAlumnos);

    }

    </script>  

</body>
</html>